version: '{build}'
image: Visual Studio 2017
notifications:
- provider: email
  on_build_success: false
environment:
  matrix:
  - ARDUINO_SDK_VERSION: 1.6.0
  - ARDUINO_SDK_VERSION: 1.8.5
install:
- ps: cinst unzip
- ps: $env:ARDUINO_SDK_FILE = "arduino-$env:ARDUINO_SDK_VERSION-windows.zip"
- ps: $env:ARDUINO_SDK_URI = "https://downloads.arduino.cc/$env:ARDUINO_SDK_FILE"
- ps: wget "$env:ARDUINO_SDK_URI" -O "$env:ARDUINO_SDK_FILE"
- ps: unzip "$env:ARDUINO_SDK_FILE" -d "arduino-sdk"
- ps: $env:ARDUINO_SDK_PATH = "$pwd\arduino-sdk\arduino-$env:ARDUINO_SDK_VERSION"
# FIXME: Windows path separators (\) need to be changed to "/" for cmake to properly handle it
- ps: $env:ARDUINO_SDK_PATH = ($env:ARDUINO_SDK_PATH -replace "\\","/")
build_script:
- ps: mkdir build
- ps: cd build
- ps: echo "$env:ARDUINO_SDK_PATH"
- ps: cmake -G "Unix Makefiles" -D ARDUINO_SDK_PATH="$env:ARDUINO_SDK_PATH" -D CMAKE_TOOLCHAIN_FILE="../cmake/Arduino-Toolchain.cmake" ..
- ps: make
after_build:
- 7z a arduino-cmake-ng.zip %APPVEYOR_BUILD_FOLDER%\cmake
artifacts:
- path: arduino-cmake-ng.zip
  name: Arduino-CMake-NG
deploy:
- provider: GitHub
  description: 'ToDo'
  artifact: arduino-cmake-ng.zip
  auth_token:
    secure:
  draft: true
  on:
    branch: master
    appveyor_repo_tag: true
on_failure:
- ps: cat CMakeFiles/CMakeOutput.log
