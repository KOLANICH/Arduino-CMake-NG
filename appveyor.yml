version: '{build}'
image: Visual Studio 2017
notifications:
- provider: Email
  on_build_success: false
environment:
  matrix:
  - ARDUINO_SDK_VERSION: 1.6.13
  - ARDUINO_SDK_VERSION: 1.8.6
install:
- ps: cinst make unzip
- ps: $env:ARDUINO_SDK_FILE = "arduino-$env:ARDUINO_SDK_VERSION-windows.zip"
- ps: $env:ARDUINO_SDK_URI = "https://downloads.arduino.cc/$env:ARDUINO_SDK_FILE"
- ps: wget "$env:ARDUINO_SDK_URI" -O "$env:ARDUINO_SDK_FILE"
- ps: unzip "$env:ARDUINO_SDK_FILE" -d "arduino-sdk"
- ps: $env:ARDUINO_SDK_PATH = "$pwd\arduino-sdk\arduino-$env:ARDUINO_SDK_VERSION"
# FIXME: Windows path separators (\) need to be changed to "/" for cmake to properly handle it
- ps: $env:ARDUINO_SDK_PATH = ($env:ARDUINO_SDK_PATH -replace "\\","/")
build_script:
- ps: mkdir build
- ps: cd build
- ps: echo "$env:ARDUINO_SDK_PATH"
- ps: >-
    cmake -G "Unix Makefiles"
    -DCMAKE_TOOLCHAIN_FILE="..\cmake\Arduino-Toolchain.cmake"
    -DARDUINO_SDK_PATH="$env:ARDUINO_SDK_PATH"
    -DCMAKE_SH="CMAKE_SH-NOTFOUND"
    ..\examples
- ps: make
after_build:
- 7z a arduino-cmake-ng.zip %APPVEYOR_BUILD_FOLDER%\cmake
artifacts:
- path: arduino-cmake-ng.zip
  name: Arduino-CMake-NG
deploy:
- provider: GitHub
  description: 'ToDo'
  artifact: arduino-cmake-ng.zip
  auth_token:
    secure: nTRyL3xmSCBVKQPd1wf/VoUSRIATFVSSCSlKm52esfQ=
  draft: true
  on:
    branch: master
    appveyor_repo_tag: true
on_failure:
- ps: cat CMakeFiles/CMakeOutput.log
